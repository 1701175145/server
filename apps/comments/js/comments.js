!function(){var e={4921:function(){OCA.Comments.ActivityTabViewPlugin={prepareModelForDisplay:function(n,e,a){if("comments"===n.get("app")&&"comments"===n.get("type")&&"ActivityTabView"===a&&(e.addClass("comment"),n.get("message")&&this._isLong(n.get("message")))){e.addClass("collapsed");var t=$("<div>").addClass("message-overlay");e.find(".activitymessage").after(t),e.on("click",this._onClickCollapsedComment)}},_onClickCollapsedComment:function(n){var e=$(n.target);e.is(".comment")||(e=e.closest(".comment")),e.removeClass("collapsed")},_isLong:function(n){return n.length>250||(n.match(/\n/g)||[]).length>1}},OC.Plugins.register("OCA.Activity.RenderingPlugins",OCA.Comments.ActivityTabViewPlugin)},75387:function(){OCA.Comments||(OCA.Comments={})},57702:function(){_.extend(OC.Files.Client,{PROPERTY_COMMENTS_UNREAD:"{"+OC.Files.Client.NS_OWNCLOUD+"}comments-unread"}),OCA.Comments=_.extend({},OCA.Comments),OCA.Comments||(OCA.Comments={}),OCA.Comments.FilesPlugin={ignoreLists:["trashbin","files.public"],_formatCommentCount:function(e){return OCA.Comments.Templates.filesplugin({count:e,countMessage:n("comments","%n unread comment","%n unread comments",e),iconUrl:OC.imagePath("core","actions/comment")})},attach:function(e){var a=this;if(!(this.ignoreLists.indexOf(e.id)>=0)){var l=e._getWebdavProperties;e._getWebdavProperties=function(){var n=l.apply(this,arguments);return n.push(OC.Files.Client.PROPERTY_COMMENTS_UNREAD),n},e.filesClient.addFileInfoParser((function(n){var e={},a=n.propStat[0].properties[OC.Files.Client.PROPERTY_COMMENTS_UNREAD];return _.isUndefined(a)||""===a||(e.commentsUnread=parseInt(a,10)),e})),e.$el.addClass("has-comments");var s=e._createRow;e._createRow=function(n){var e=s.apply(this,arguments);return n.commentsUnread&&e.attr("data-comments-unread",n.commentsUnread),e},e.fileActions.registerAction({name:"Comment",displayName:function(e){if(e&&e.$file){var a=parseInt(e.$file.data("comments-unread"),10);if(a>=0)return n("comments","1 new comment","{unread} new comments",a,{unread:a})}return t("comments","Comment")},mime:"all",order:-140,iconClass:"icon-comment",permissions:OC.PERMISSION_READ,type:OCA.Files.FileActions.TYPE_INLINE,render:function(n,e,t){var l=t.$file.data("comments-unread");if(l){var s=$(a._formatCommentCount(l));return t.$file.find("a.name>span.fileactions").append(s),s}return""},actionHandler:function(n,e){e.$file.find(".action-comment").tooltip("hide"),OCA.Files.Sidebar.setActiveTab("comments"),OCA.Files.Sidebar.open("/"+n)}});var i=e.elementToFile;e.elementToFile=function(n){var e=i.apply(this,arguments),a=n.data("comments-unread");return a&&(e.commentsUnread=a),e}}}},OC.Plugins.register("OCA.Files.FileList",OCA.Comments.FilesPlugin)},4543:function(){function n(e){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(n){return typeof n}:function(n){return n&&"function"==typeof Symbol&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n})(e)}var e,a;e=Handlebars.template,(a=OCA.Comments.Templates=OCA.Comments.Templates||{}).comment=e({1:function(n,e,a,t,l){return" unread"},3:function(n,e,a,t,l){return" collapsed"},5:function(n,e,a,t,l){return" currentUser"},7:function(n,e,a,t,l){var s;return'data-username="'+n.escapeExpression("function"==typeof(s=null!=(s=a.actorId||(null!=e?e.actorId:e))?s:a.helperMissing)?s.call(null!=e?e:n.nullContext||{},{"name":"actorId","hash":{},"data":l}):s)+'"'},9:function(n,e,a,t,l){return'\t\t\t<a href="#" class="action more icon icon-more has-tooltip"></a>\n\t\t\t<div class="deleteLoading icon-loading-small hidden"></div>\n'},11:function(n,e,a,t,l){return'\t\t<div class="message-overlay"></div>\n'},"compiler":[7,">= 4.0.0"],"main":function(e,a,t,l,s){var i,o,r=null!=a?a:e.nullContext||{},m=t.helperMissing,c="function",u=e.escapeExpression;return'<li class="comment'+(null!=(i=t.if.call(r,null!=a?a.isUnread:a,{"name":"if","hash":{},"fn":e.program(1,s,0),"inverse":e.noop,"data":s}))?i:"")+(null!=(i=t.if.call(r,null!=a?a.isLong:a,{"name":"if","hash":{},"fn":e.program(3,s,0),"inverse":e.noop,"data":s}))?i:"")+'" data-id="'+u(n(o=null!=(o=t.id||(null!=a?a.id:a))?o:m)===c?o.call(r,{"name":"id","hash":{},"data":s}):o)+'">\n\t<div class="authorRow">\n\t\t<div class="avatar'+(null!=(i=t.if.call(r,null!=a?a.isUserAuthor:a,{"name":"if","hash":{},"fn":e.program(5,s,0),"inverse":e.noop,"data":s}))?i:"")+'" '+(null!=(i=t.if.call(r,null!=a?a.actorId:a,{"name":"if","hash":{},"fn":e.program(7,s,0),"inverse":e.noop,"data":s}))?i:"")+'> </div>\n\t\t<div class="author'+(null!=(i=t.if.call(r,null!=a?a.isUserAuthor:a,{"name":"if","hash":{},"fn":e.program(5,s,0),"inverse":e.noop,"data":s}))?i:"")+'">'+u(n(o=null!=(o=t.actorDisplayName||(null!=a?a.actorDisplayName:a))?o:m)===c?o.call(r,{"name":"actorDisplayName","hash":{},"data":s}):o)+"</div>\n"+(null!=(i=t.if.call(r,null!=a?a.isUserAuthor:a,{"name":"if","hash":{},"fn":e.program(9,s,0),"inverse":e.noop,"data":s}))?i:"")+'\t\t<div class="date has-tooltip live-relative-timestamp" data-timestamp="'+u(n(o=null!=(o=t.timestamp||(null!=a?a.timestamp:a))?o:m)===c?o.call(r,{"name":"timestamp","hash":{},"data":s}):o)+'" title="'+u(n(o=null!=(o=t.altDate||(null!=a?a.altDate:a))?o:m)===c?o.call(r,{"name":"altDate","hash":{},"data":s}):o)+'">'+u(n(o=null!=(o=t.date||(null!=a?a.date:a))?o:m)===c?o.call(r,{"name":"date","hash":{},"data":s}):o)+'</div>\n\t</div>\n\t<div class="message">'+(null!=(i=n(o=null!=(o=t.formattedMessage||(null!=a?a.formattedMessage:a))?o:m)===c?o.call(r,{"name":"formattedMessage","hash":{},"data":s}):o)?i:"")+"</div>\n"+(null!=(i=t.if.call(r,null!=a?a.isLong:a,{"name":"if","hash":{},"fn":e.program(11,s,0),"inverse":e.noop,"data":s}))?i:"")+"</li>\n"},"useData":!0}),a.commentsmodifymenu=e({1:function(e,a,t,l,s){var i,o,r=null!=a?a:e.nullContext||{},m=t.helperMissing,c="function",u=e.escapeExpression;return'\t\t<li>\n\t\t\t<a href="#" class="menuitem action '+u(n(o=null!=(o=t.name||(null!=a?a.name:a))?o:m)===c?o.call(r,{"name":"name","hash":{},"data":s}):o)+' permanent" data-action="'+u(n(o=null!=(o=t.name||(null!=a?a.name:a))?o:m)===c?o.call(r,{"name":"name","hash":{},"data":s}):o)+'">\n'+(null!=(i=t.if.call(r,null!=a?a.iconClass:a,{"name":"if","hash":{},"fn":e.program(2,s,0),"inverse":e.program(4,s,0),"data":s}))?i:"")+"\t\t\t\t<span>"+u(n(o=null!=(o=t.displayName||(null!=a?a.displayName:a))?o:m)===c?o.call(r,{"name":"displayName","hash":{},"data":s}):o)+"</span>\n\t\t\t</a>\n\t\t</li>\n"},2:function(n,e,a,t,l){var s;return'\t\t\t\t\t<span class="icon '+n.escapeExpression("function"==typeof(s=null!=(s=a.iconClass||(null!=e?e.iconClass:e))?s:a.helperMissing)?s.call(null!=e?e:n.nullContext||{},{"name":"iconClass","hash":{},"data":l}):s)+'"></span>\n'},4:function(n,e,a,t,l){return'\t\t\t\t\t<span class="no-icon"></span>\n'},"compiler":[7,">= 4.0.0"],"main":function(n,e,a,t,l){var s;return"<ul>\n"+(null!=(s=a.each.call(null!=e?e:n.nullContext||{},null!=e?e.items:e,{"name":"each","hash":{},"fn":n.program(1,l,0),"inverse":n.noop,"data":l}))?s:"")+"</ul>\n"},"useData":!0}),a.edit_comment=e({1:function(n,e,a,t,l){var s;return'\t\t\t<div class="action-container">\n\t\t\t\t<a href="#" class="action cancel icon icon-close has-tooltip" title="'+n.escapeExpression("function"==typeof(s=null!=(s=a.cancelText||(null!=e?e.cancelText:e))?s:a.helperMissing)?s.call(null!=e?e:n.nullContext||{},{"name":"cancelText","hash":{},"data":l}):s)+'"></a>\n\t\t\t</div>\n'},"compiler":[7,">= 4.0.0"],"main":function(e,a,t,l,s){var i,o,r=null!=a?a:e.nullContext||{},m=t.helperMissing,c="function",u=e.escapeExpression;return"<"+u(n(o=null!=(o=t.tag||(null!=a?a.tag:a))?o:m)===c?o.call(r,{"name":"tag","hash":{},"data":s}):o)+' class="newCommentRow comment" data-id="'+u(n(o=null!=(o=t.id||(null!=a?a.id:a))?o:m)===c?o.call(r,{"name":"id","hash":{},"data":s}):o)+'">\n\t<div class="authorRow">\n\t\t<div class="avatar currentUser" data-username="'+u(n(o=null!=(o=t.actorId||(null!=a?a.actorId:a))?o:m)===c?o.call(r,{"name":"actorId","hash":{},"data":s}):o)+'"></div>\n\t\t<div class="author currentUser">'+u(n(o=null!=(o=t.actorDisplayName||(null!=a?a.actorDisplayName:a))?o:m)===c?o.call(r,{"name":"actorDisplayName","hash":{},"data":s}):o)+"</div>\n"+(null!=(i=t.if.call(r,null!=a?a.isEditMode:a,{"name":"if","hash":{},"fn":e.program(1,s,0),"inverse":e.noop,"data":s}))?i:"")+'\t</div>\n\t<form class="newCommentForm">\n\t\t<div contentEditable="true" class="message" data-placeholder="'+u(n(o=null!=(o=t.newMessagePlaceholder||(null!=a?a.newMessagePlaceholder:a))?o:m)===c?o.call(r,{"name":"newMessagePlaceholder","hash":{},"data":s}):o)+'">'+u(n(o=null!=(o=t.message||(null!=a?a.message:a))?o:m)===c?o.call(r,{"name":"message","hash":{},"data":s}):o)+'</div>\n\t\t<input class="submit icon-confirm has-tooltip" type="submit" value="" title="'+u(n(o=null!=(o=t.submitText||(null!=a?a.submitText:a))?o:m)===c?o.call(r,{"name":"submitText","hash":{},"data":s}):o)+'"/>\n\t\t<div class="submitLoading icon-loading-small hidden"></div>\n\t</form>\n</'+u(n(o=null!=(o=t.tag||(null!=a?a.tag:a))?o:m)===c?o.call(r,{"name":"tag","hash":{},"data":s}):o)+">\n"},"useData":!0}),a.filesplugin=e({"compiler":[7,">= 4.0.0"],"main":function(e,a,t,l,s){var i,o=null!=a?a:e.nullContext||{},r=t.helperMissing,m="function",c=e.escapeExpression;return'<a class="action action-comment permanent" title="'+c(n(i=null!=(i=t.countMessage||(null!=a?a.countMessage:a))?i:r)===m?i.call(o,{"name":"countMessage","hash":{},"data":s}):i)+'" href="#">\n\t<img class="svg" src="'+c(n(i=null!=(i=t.iconUrl||(null!=a?a.iconUrl:a))?i:r)===m?i.call(o,{"name":"iconUrl","hash":{},"data":s}):i)+'"/>\n</a>\n'},"useData":!0}),a.view=e({"compiler":[7,">= 4.0.0"],"main":function(e,a,t,l,s){var i,o=null!=a?a:e.nullContext||{},r=t.helperMissing,m="function",c=e.escapeExpression;return'<ul class="comments">\n</ul>\n<div class="emptycontent hidden"><div class="icon-comment"></div>\n\t<p>'+c(n(i=null!=(i=t.emptyResultLabel||(null!=a?a.emptyResultLabel:a))?i:r)===m?i.call(o,{"name":"emptyResultLabel","hash":{},"data":s}):i)+'</p></div>\n<input type="button" class="showMore hidden" value="'+c(n(i=null!=(i=t.moreLabel||(null!=a?a.moreLabel:a))?i:r)===m?i.call(o,{"name":"moreLabel","hash":{},"data":s}):i)+'" name="show-more" id="show-more" />\n<div class="loading hidden" style="height: 50px"></div>\n'},"useData":!0})}},a={};function l(n){if(a[n])return a[n].exports;var t=a[n]={exports:{}};return e[n](t,t.exports,l),t.exports}l.n=function(n){var e=n&&n.__esModule?function(){return n.default}:function(){return n};return l.d(e,{a:e}),e},l.d=function(n,e){for(var a in e)l.o(e,a)&&!l.o(n,a)&&Object.defineProperty(n,a,{enumerable:!0,get:e[a]})},l.o=function(n,e){return Object.prototype.hasOwnProperty.call(n,e)},function(){"use strict";l(75387),l(4543),l(57702),l(4921);window.OCA.Comments=OCA.Comments}()}();
//# sourceMappingURL=comments.js.map